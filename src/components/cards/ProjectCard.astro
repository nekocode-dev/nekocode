---
/**
 * ProjectCard - For work/apps grid
 */
import Tag from '@/components/ui/Tag.astro';

interface Props {
  slug: string;
  title: string;
  subtitle?: string;
  logo?: string;
  tagline: string;
  coverImage: string;
  type: 'app' | 'website' | 'research' | 'open_source';
  platforms: ('web' | 'ios' | 'android')[];
  tech: string[];
  featured?: boolean;
  status?: 'live' | 'in_progress' | 'archived';
  class?: string;
}

const {
  slug,
  title,
  tagline,
  coverImage,
  type,
  platforms,
  tech,
  featured = false,
  status = 'live',
  class: className = '',
  ...rest
} = Astro.props;



const base = import.meta.env.BASE_URL;
const baseUrl = type === 'app' ? `${base}apps` : `${base}work`;
// Resolve cover image path
const resolvedCoverImage = coverImage.startsWith('/') ? `${base}${coverImage.slice(1)}` : coverImage;
---

<a 
  href={`${baseUrl}/${slug}`} 
  class:list={['project-card card-shine', { 'bento-featured': featured, 'coming-soon': status === 'coming_soon' }, className]}
  data-tilt
  {...rest}
>
  <div class="card-media">
    {Astro.props.logo ? (
      <div class="card-logo-container">
        <img 
          src={Astro.props.logo.startsWith('/') ? `${base}${Astro.props.logo.slice(1)}` : Astro.props.logo}
          alt={`${title} logo`}
          class="card-logo"
          loading="lazy"
          decoding="async"
        />
      </div>
    ) : (
      <img 
        src={resolvedCoverImage} 
        alt={`${title} cover`}
        loading="lazy"
        decoding="async"
      />
    )}
    {status === 'coming_soon' ? (
      <div class="coming-soon-overlay">
        <span class="coming-soon-badge">Coming Soon</span>
      </div>
    ) : (
      <div class="card-overlay">
        <span class="view-project">
          {type === 'app' ? 'View App →' : 'View Case Study →'}
        </span>
      </div>
    )}
  </div>
  
  <div class="card-content">
    <div class="card-header">
      <h3 class="card-title">{title}</h3>
      {status === 'live' && (
        <Tag variant="accent" size="sm">Live</Tag>
      )}
      {status === 'in_progress' && (
        <Tag variant="accent" size="sm">In Progress</Tag>
      )}
      {status === 'coming_soon' && (
        <Tag variant="outline" size="sm">Coming Soon</Tag>
      )}
    </div>
    
    {Astro.props.subtitle && (
      <p class="card-subtitle">{Astro.props.subtitle}</p>
    )}
    
    <div class="tech-stack">
      {tech.slice(0, 3).map(t => (
        <Tag size="sm">{t}</Tag>
      ))}
      {tech.length > 3 && (
        <Tag size="sm" variant="outline">+{tech.length - 3}</Tag>
      )}
    </div>
    
    <p class="card-tagline">{tagline}</p>
  </div>
</a>

<style>
  .project-card {
    display: flex;
    flex-direction: column;
    background: var(--color-surface);
    border-radius: var(--radius-xl);
    border: 1px solid var(--color-border);
    overflow: hidden;
    text-decoration: none;
    transition: all var(--duration-normal) var(--ease-out);
  }
  
  .project-card:hover {
    border-color: var(--color-accent);
    box-shadow: var(--shadow-lg), var(--shadow-glow);
    transform: translateY(-4px);
  }
  
  .card-media {
    position: relative;
    aspect-ratio: 16 / 10;
    overflow: hidden;
    background: var(--color-border-subtle);
  }
  
  .card-media > img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform var(--duration-slow) var(--ease-out);
  }
  
  .project-card:hover .card-media img {
    transform: scale(1.05);
  }
  
  .card-overlay {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(23, 23, 23, 0.6);
    opacity: 0;
    transition: opacity var(--duration-normal) var(--ease-out);
  }
  
  .project-card:hover .card-overlay {
    opacity: 1;
  }
  
  .view-project {
    padding: var(--space-3) var(--space-5);
    background: var(--color-accent);
    color: var(--color-accent-contrast);
    border-radius: var(--radius-full);
    font-weight: 500;
    font-size: var(--text-sm);
  }
  
  .card-content {
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
    padding: var(--space-5);
  }
  
  .card-header {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    flex-wrap: wrap;
  }
  
  .card-title {
    font-family: var(--font-display);
    font-size: var(--text-xl);
    font-weight: 600;
    color: var(--color-text);
    margin: 0;
  }
  
  .card-tagline {
    color: var(--color-text-secondary);
    font-size: var(--text-sm);
    line-height: var(--leading-relaxed);
    margin: 0;
    margin-top: auto; /* Push to bottom */
  }
  
  .tech-stack {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
    margin-top: var(--space-2);
  }
  
  .tech-stack {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
  }
  
  /* Featured card gets more space */
  .bento-featured .card-media {
    aspect-ratio: 16 / 9;
  }
  
  .bento-featured .card-title {
    font-size: var(--text-2xl);
  }
  
  /* Coming Soon state */
  .coming-soon {
    pointer-events: none;
    opacity: 0.85;
  }
  
  .coming-soon .card-media img {
    filter: grayscale(0.3);
  }
  
  .coming-soon-overlay {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(23, 23, 23, 0.5);
    backdrop-filter: blur(2px);
  }
  
  .coming-soon-badge {
    padding: var(--space-3) var(--space-6);
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(12px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: #fff;
    border-radius: var(--radius-full);
    font-weight: 600;
    font-size: var(--text-sm);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    box-shadow: 0 4px 24px rgba(0, 0, 0, 0.2);
  }
  
  .card-logo-container {
    width: 100%;
    height: 100%;
    background: #111; /* Dark background */
    display: flex;
    align-items: center;
    justify-content: center;
    border-bottom: 1px solid var(--color-border-subtle);
  }
  
  .card-logo {
    width: 80px !important;
    height: 80px !important;
    object-fit: contain !important;
    border-radius: 22%; /* App icon shape */
    transition: transform var(--duration-normal) var(--ease-out);
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  }
  
  .project-card:hover .card-logo {
    transform: scale(1.1);
  }
</style>
