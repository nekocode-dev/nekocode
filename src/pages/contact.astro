---
import BaseLayout from '@/layouts/BaseLayout.astro';
import NavBar from '@/components/nav/NavBar.astro';
import Footer from '@/components/nav/Footer.astro';
import Container from '@/components/layout/Container.astro';
import Section from '@/components/layout/Section.astro';
import Button from '@/components/ui/Button.astro';
---

<BaseLayout title="Contact" description="Get in touch with NekoCode">
  <NavBar slot="header" />
  
  <Section size="lg">
    <Container size="narrow">
      <div class="contact-header">
        <h1 class="text-title-1">Get in Touch</h1>
        <p class="contact-description">
          Have a project in mind? Want to collaborate? Or just want to say hi? 
          I would love to hear from you.
        </p>
      </div>
      
      <form id="contact-form" class="contact-form">
        <div class="form-group">
          <label for="name">Name</label>
          <input type="text" id="name" name="name" required placeholder="Your name" />
        </div>
        
        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" id="email" name="email" required placeholder="you@example.com" />
        </div>
        
        <div class="form-group">
          <label for="subject">Subject</label>
          <select id="subject" name="subject" required>
            <option value="">Select a topic</option>
            <option value="project">Project Inquiry</option>
            <option value="consulting">Consulting</option>
            <option value="collaboration">Collaboration</option>
            <option value="other">Other</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="message">Message</label>
          <textarea id="message" name="message" rows="6" required placeholder="Tell me about your project..."></textarea>
        </div>

        <!-- Honeypot Field (Hidden from humans) -->
        <div class="form-group honeypot" aria-hidden="true">
          <label for="website_url">Website URL (Do not fill)</label>
          <input type="text" id="website_url" name="website_url" tabindex="-1" autocomplete="off" />
        </div>
        
        <div id="form-status" class="form-status hidden"></div>

        <Button type="submit" variant="accent" size="lg" id="submit-btn">
          Send Message
        </Button>
      </form>
      
<script>
  // PASTE YOUR GOOGLE APP SCRIPT URL HERE
  const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyKecivW_-lSa7L_tSgCmcf8c0upzL3ngjFaKXIdPcZR0AAuKJGLYyGX3yh3tGIjmkK/exec';

  const form = document.getElementById('contact-form');
  const statusDiv = document.getElementById('form-status');
  const submitBtn = document.getElementById('submit-btn');

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    if (!form || !statusDiv || !submitBtn) return;

    // UI Loading State
    const originalBtnText = submitBtn.innerText;
    submitBtn.innerText = 'Sending...';
    submitBtn.style.opacity = '0.7';
    submitBtn.style.pointerEvents = 'none';
    statusDiv.classList.add('hidden');

    // Honeypot Check
    const honeypot = document.getElementById('website_url') as HTMLInputElement;
    if (honeypot && honeypot.value) {
      // It's a bot! Fake success, do not send request.
      console.log('Bot detected. Silently rejecting.');
      // Simulate network delay
      await new Promise(r => setTimeout(r, 1000));
      
      statusDiv.innerHTML = '✅ Message sent successfully! I will get back to you soon.';
      statusDiv.className = 'form-status success';
      form.reset();
      
      // Reset UI
      submitBtn.innerText = originalBtnText;
      submitBtn.style.opacity = '1';
      submitBtn.style.pointerEvents = 'auto';
      return;
    }

    try {
      const formData = new FormData(form);
      // Remove honeypot from data
      formData.delete('website_url'); 
      const jsonData = Object.fromEntries(formData.entries());

      // Use no-cors mode for Google Scripts
      await fetch(GOOGLE_SCRIPT_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'text/plain' }, // Google requires text/plain to avoid preflight
        body: JSON.stringify(jsonData)
      });

      // Success
      statusDiv.innerHTML = '✅ Message sent successfully! I will get back to you soon.';
      statusDiv.className = 'form-status success';
      form.reset();

    } catch (error) {
      console.error('Submission error:', error);
      statusDiv.innerHTML = '❌ Something went wrong. Please try again or email directly.';
      statusDiv.className = 'form-status error';
    } finally {
      // Reset UI
      submitBtn.innerText = originalBtnText;
      submitBtn.style.opacity = '1';
      submitBtn.style.pointerEvents = 'auto';
    }
  });
</script>
      
      <div class="contact-alt">
        <p>Prefer email directly?</p>
        <a href="mailto:hello@nekocode.dev" class="email-link">
          hello@nekocode.dev
        </a>
      </div>
      
      <div class="social-links">
        <a href="https://github.com/nekocode" target="_blank" rel="noopener noreferrer">
          GitHub
        </a>
        <span class="divider">•</span>
        <a href="#" target="_blank" rel="noopener noreferrer">
          LinkedIn
        </a>
        <span class="divider">•</span>
        <a href="#" target="_blank" rel="noopener noreferrer">
          Twitter
        </a>
      </div>
    </Container>
  </Section>
  
  <Footer slot="footer" />
</BaseLayout>

<style>
  .contact-header {
    text-align: center;
    margin-bottom: var(--space-12);
  }
  
  .contact-header h1 {
    margin-bottom: var(--space-4);
  }
  
  .contact-description {
    font-size: var(--text-lg);
    color: var(--color-text-secondary);
    max-width: 480px;
    margin-inline: auto;
  }
  
  .contact-form {
    display: flex;
    flex-direction: column;
    gap: var(--space-5);
    padding: var(--space-8);
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-2xl);
  }
  
  .form-group {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
  }
  
  .form-group label {
    font-size: var(--text-sm);
    font-weight: 500;
    color: var(--color-text);
  }
  
  .form-group input,
  .form-group select,
  .form-group textarea {
    padding: var(--space-3) var(--space-4);
    background: var(--color-bg);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    font-size: var(--text-base);
    color: var(--color-text);
    transition: all var(--duration-fast) var(--ease-out);
  }
  
  .form-group input::placeholder,
  .form-group textarea::placeholder {
    color: var(--color-muted);
  }
  
  .form-group select {
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23888888' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 12px center;
    background-size: 16px;
    padding-right: 40px;
    cursor: pointer;
  }

  .form-group input:focus,
  .form-group select:focus,
  .form-group textarea:focus {
    outline: none;
    border-color: var(--color-accent);
    box-shadow: 0 0 0 3px var(--color-glow);
  }
  
  .form-group textarea {
    resize: vertical;
    min-height: 120px;
  }
  
  .contact-alt {
    text-align: center;
    margin-top: var(--space-10);
    padding-top: var(--space-10);
    border-top: 1px solid var(--color-border);
  }
  
  .contact-alt p {
    font-size: var(--text-sm);
    color: var(--color-muted);
    margin-bottom: var(--space-2);
  }
  
  .email-link {
    font-size: var(--text-xl);
    font-weight: 500;
    color: var(--color-text);
    transition: color var(--duration-fast) var(--ease-out);
  }
  
  .email-link:hover {
    color: var(--color-accent);
  }
  
  .social-links {
    display: flex;
    justify-content: center;
    gap: var(--space-4);
    margin-top: var(--space-8);
    font-size: var(--text-sm);
    color: var(--color-text-secondary);
  }
  
  .social-links a {
    transition: color var(--duration-fast) var(--ease-out);
  }
  
  .social-links a:hover {
    color: var(--color-text);
  }
  
  .divider {
    color: var(--color-muted);
  }

  .form-status {
    margin-bottom: var(--space-4);
    padding: var(--space-3);
    border-radius: var(--radius-md);
    font-size: var(--text-sm);
    text-align: center;
  }

  .form-status.success {
    background: rgba(16, 185, 129, 0.1);
    color: #10b981;
    border: 1px solid rgba(16, 185, 129, 0.2);
  }

  .form-status.error {
    background: rgba(239, 68, 68, 0.1);
    color: #ef4444;
    border: 1px solid rgba(239, 68, 68, 0.2);
  }

  .hidden, 
  .honeypot {
    display: none;
    visibility: hidden;
    position: absolute;
    left: -9999px;
  }
</style>
