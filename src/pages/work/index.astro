---
import BaseLayout from '@/layouts/BaseLayout.astro';
import NavBar from '@/components/nav/NavBar.astro';
import Footer from '@/components/nav/Footer.astro';
import Container from '@/components/layout/Container.astro';
import Section from '@/components/layout/Section.astro';
import BentoGrid from '@/components/layout/BentoGrid.astro';
import ProjectCard from '@/components/cards/ProjectCard.astro';
import Tag from '@/components/ui/Tag.astro';
import { getCollection } from 'astro:content';

// Get all projects
const allProjects = await getCollection('projects');

// Extract unique values for filters
const allTypes = [...new Set(allProjects.map(p => p.data.type))];
const allPlatforms = [...new Set(allProjects.flatMap(p => p.data.platforms))];
const allTech = [...new Set(allProjects.flatMap(p => p.data.tech))];
---

<BaseLayout title="Work" description="Explore my products and concepts">
  <NavBar slot="header" />
  
  <Section size="lg">
    <Container>
      <div class="page-header">
        <h1 class="text-title-1">Work</h1>
        <p class="page-description">
          Real applications and interactive concepts I have built. Click any card to dive deeper.
        </p>
      </div>
      
      <!-- Filter Bar -->
      <div class="filter-bar" role="group" aria-label="Filter projects">
        <div class="filter-group">
          <span class="filter-label">Type:</span>
          <div class="filter-chips">
            <button class="filter-chip active" data-filter="type" data-value="all">All</button>
            {allTypes.map(type => (
              <button class="filter-chip" data-filter="type" data-value={type}>
                {type.replace('_', ' ')}
              </button>
            ))}
          </div>
        </div>
        
        <div class="filter-group">
          <span class="filter-label">Platform:</span>
          <div class="filter-chips">
            <button class="filter-chip active" data-filter="platform" data-value="all">All</button>
            {allPlatforms.map(platform => (
              <button class="filter-chip" data-filter="platform" data-value={platform}>
                {platform}
              </button>
            ))}
          </div>
        </div>
      </div>
      
      <!-- Projects Grid -->
      <BentoGrid columns={3} gap="md">
        {allProjects.map((project, index) => (
          <ProjectCard
            slug={project.slug}
            title={project.data.title}
            subtitle={project.data.subtitle}
            logo={project.data.media.logo}
            tagline={project.data.tagline}
            coverImage={project.data.media.coverImage}
            type={project.data.type}
            platforms={project.data.platforms}
            tech={project.data.tech}
            status={project.data.status}
            featured={project.data.featured && index < 2}
            data-type={project.data.type}
            data-platforms={project.data.platforms.join(',')}
          />
        ))}
      </BentoGrid>
      
      <!-- Empty State -->
      <div class="empty-state" hidden>
        <p>No projects match your filters.</p>
        <button class="reset-filters">Reset Filters</button>
      </div>
    </Container>
  </Section>
  
  <Footer slot="footer" />
</BaseLayout>

<style>
  .page-header {
    margin-bottom: var(--space-10);
  }
  
  .page-header h1 {
    margin-bottom: var(--space-3);
  }
  
  .page-description {
    font-size: var(--text-lg);
    color: var(--color-text-secondary);
    max-width: 560px;
  }
  
  .filter-bar {
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
    padding: var(--space-5);
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-xl);
    margin-bottom: var(--space-8);
  }
  
  .filter-group {
    display: flex;
    align-items: center;
    gap: var(--space-4);
    flex-wrap: wrap;
  }
  
  .filter-label {
    font-size: var(--text-sm);
    font-weight: 500;
    color: var(--color-muted);
    min-width: 70px;
  }
  
  .filter-chips {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
  }
  
  .filter-chip {
    padding: var(--space-2) var(--space-4);
    background: transparent;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-full);
    font-size: var(--text-sm);
    color: var(--color-text-secondary);
    cursor: pointer;
    transition: all var(--duration-fast) var(--ease-out);
    text-transform: capitalize;
  }
  
  .filter-chip:hover {
    border-color: var(--color-text-secondary);
    color: var(--color-text);
  }
  
  .filter-chip.active {
    background: var(--color-accent);
    border-color: var(--color-accent);
    color: var(--color-accent-contrast);
  }
  
  .empty-state {
    text-align: center;
    padding: var(--space-16);
    color: var(--color-muted);
  }
  
  .reset-filters {
    margin-top: var(--space-4);
    padding: var(--space-2) var(--space-4);
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all var(--duration-fast) var(--ease-out);
  }
  
  .reset-filters:hover {
    border-color: var(--color-text);
  }
</style>

<script>
  // Simple client-side filtering
  const filterChips = document.querySelectorAll('.filter-chip');
  const projectCards = document.querySelectorAll('.project-card');
  
  let activeFilters = {
    type: 'all',
    platform: 'all'
  };
  
  filterChips.forEach(chip => {
    chip.addEventListener('click', () => {
      const filterType = chip.dataset.filter;
      const value = chip.dataset.value;
      
      // Update active state
      document.querySelectorAll(`[data-filter="${filterType}"]`).forEach(c => {
        c.classList.remove('active');
      });
      chip.classList.add('active');
      
      // Update filter value
      activeFilters[filterType] = value;
      
      // Apply filters
      applyFilters();
    });
  });
  
  function applyFilters() {
    projectCards.forEach(card => {
      const cardType = card.dataset.type;
      const cardPlatforms = card.dataset.platforms?.split(',') || [];
      
      const matchesType = activeFilters.type === 'all' || cardType === activeFilters.type;
      const matchesPlatform = activeFilters.platform === 'all' || cardPlatforms.includes(activeFilters.platform);
      
      card.style.display = matchesType && matchesPlatform ? '' : 'none';
    });
  }
</script>
